!function(){var e=angular.module("dashboard-app",["ngCookies"]);e.directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,a){function n(){var e=t.html();e=e.replace(/&nbsp;/g,"Â "),a.$setViewValue(e)}a.$render=function(){t.html(a.$viewValue||"")},t.bind("keyup change",function(){e.$apply(n)}),t.bind("blur",function(){var t=a.$viewValue.trim();t||(t=o.defaultvalue,a.$setViewValue(t),a.$render()),e.$apply(n)}),t.bind("keydown keypress",function(e){var o="undefined"==typeof e.which?e.keyCode:e.which;13===o&&(t.blur(),e.preventDefault())})}}})}(),$(function(){$(function(e){e(".editable").focusout(function(){var t=e(this);t.text().replace(" ","").length||t.empty()})}),$("#quote a").popover({html:"true",placement:"top",trigger:"hover",content:function(){return $("#quote-popover").html()}}),$("#weather a").popover({html:"true",placement:"top",trigger:"hover",content:function(){return $("#weather-popover").html()}}),$("#photo a").popover({html:"true",placement:"top",trigger:"hover",content:function(){return $("#photo-popover").html()}})}),function(){"use strict";function e(e,t,o,a,n){var s=this;s.dashboard=t.getObject("dashboard"),s.settings=t.getObject("settings"),s.isBusy=!0,s.errorMessage="",s.settings||(s.settings={},s.settings.defaultName="Young Grasshopper",s.settings.name=s.settings.defaultName,s.settings.defaultQuestion="What is your goal for today?",s.settings.question=s.settings.defaultQuestion,s.settings.location="",s.settings.showTime=!0,s.settings.showFocus=!0,s.settings.showWeather=!0,s.settings.showQuote=!0,s.settings.showGreeting=!0),e.$watch("[vm.settings]",function(){s.saveSettings()},!0),s.saveDashboard=function(){var e=new Date;e.setTime(e.getTime()+18e5),t.putObject("dashboard",s.dashboard,{expires:e})},s.saveSettings=function(){var e=new Date,o=new Date(e.getFullYear()+10,e.getMonth(),e.getDate());t.putObject("settings",s.settings,{expires:o})},s.getNextElementIndex=function(e,t){return t+=1,t>=e.length&&(t=0),t},s.getDashboard=function(){s.isBusy=!0;var e=(new Date).getTimezoneOffset(),t=Date.now()-60*e*1e3;o.get("/api/dashboard/"+t).then(function(e){s.dashboard=e.data,s.dashboard.quoteIndex=s.getNextElementIndex(s.dashboard.quotes,0),s.dashboard.quote=s.dashboard.quotes[s.dashboard.quoteIndex],s.dashboard.photoIndex=s.getNextElementIndex(s.dashboard.photos,0),s.dashboard.photo=s.dashboard.photos[s.dashboard.photoIndex];for(var t=0;t<s.dashboard.photos.length;t++){var o=s.dashboard.photos[t].name;s.dashboard.photos[t].shortName=o,o.length>20&&(s.dashboard.photos[t].shortName=o.replace(/^(.{20}[^\s]*).*/,"$1"),s.dashboard.photos[t].shortName.length<o.length+3&&(s.dashboard.photos[t].shortName=s.dashboard.photos[t].shortName+"..."))}s.settings.location||(s.settings.location=s.dashboard.weather.location),s.saveDashboard()},function(e){s.errorMessage="Failed to load data: "+e})["finally"](function(){s.isBusy=!1})},s.updateTime=function(){var e=function(){s.time=Date.now()};e(),a(e,6e4)},s.updateTime(),a(s.getDashboard,18e5),s.refresh=function(){s.dashboard?(s.dashboard.quoteIndex=s.getNextElementIndex(s.dashboard.quotes,s.dashboard.quoteIndex),s.dashboard.quote=s.dashboard.quotes[s.dashboard.quoteIndex],s.dashboard.photoIndex=s.getNextElementIndex(s.dashboard.photos,s.dashboard.photoIndex),s.dashboard.photo=s.dashboard.photos[s.dashboard.photoIndex],s.saveDashboard(),s.isBusy=!1):s.getDashboard()},s.refresh(),s.startFade=!1,s.fadeAndRefresh=function(){s.startFade=!0,n(function(){s.startFade=!1,s.refresh()},1e3)}}angular.module("dashboard-app").controller("dashboardController",e)}();